<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA DETECTOR DOMUS MAGI</title>
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>
    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';

      // 1. Inicialización del motor apuntando a tu archivo targets1.mind
      const mindarThree = new MindARThree({
        container: document.querySelector("#container"),
        imageTargetSrc: "./targets1.mind?v=5" // Cache buster para forzar carga nueva
      });

      const {renderer, scene, camera} = mindarThree;

      // 2. Configuración de los 4 Marcadores (Anchors)
      const setupAnchor = (index, colorName, label) => {
        const anchor = mindarThree.addAnchor(index);
        const geometry = new THREE.PlaneGeometry(1, 1); // Cuadrada como tus cartas
        const material = new THREE.MeshBasicMaterial({color: colorName, transparent: true, opacity: 0.5});
        const plane = new THREE.Mesh(geometry, material);
        anchor.group.add(plane);

        // Eventos de detección para informar en pantalla
        anchor.onTargetFound = () => {
          document.querySelector("#status").innerText = "DETECTADO: " + label;
          document.querySelector("#status").style.background = colorName;
        };
        anchor.onTargetLost = () => {
          document.querySelector("#status").innerText = "ESCANEANDO...";
          document.querySelector("#status").style.background = "rgba(0,0,0,0.5)";
        };
      }

      // Definimos los 4 objetivos según el orden de tu imagen
      setupAnchor(0, 0x00ffff, "DRACO (AZUL)");
      setupAnchor(1, 0x5fd4ff, "AQUILA (AZUL CLARO)");
      setupAnchor(2, 0xff9900, "LEO (NARANJA)");
      setupAnchor(3, 0xff5500, "APER (ROJO)");

      const start = async() => {
        document.querySelector("#status").innerText = "INICIANDO CÁMARA...";
        await mindarThree.start();
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
        document.querySelector("#status").innerText = "BUSCANDO CARTA...";
      }

      document.querySelector("#startButton").addEventListener("click", () => {
        start();
        document.querySelector("#control").style.display = "none";
      });
    </script>
    <style>
      body { margin: 0; background: #000; font-family: sans-serif; }
      #container { width: 100vw; height: 100vh; position: relative; overflow: hidden; }
      
      /* Botón de inicio gigante para móviles */
      #control {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        background: #000; z-index: 10;
      }
      #startButton {
        padding: 20px 50px; font-size: 24px; font-weight: bold;
        background: #0f0; color: #000; border: none; border-radius: 50px; cursor: pointer;
      }
      
      /* Barra de estado superior */
      #status {
        position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
        padding: 10px 20px; color: white; background: rgba(0,0,0,0.5);
        border-radius: 10px; z-index: 5; text-align: center; min-width: 200px;
        pointer-events: none; border: 1px solid white;
      }
    </style>
  </head>
  <body>
    <div id="status">SISTEMA LISTO</div>
    <div id="control">
      <button id="startButton">INICIAR ESCÁNER</button>
    </div>
    <div id="container"></div>
  </body>
</html>