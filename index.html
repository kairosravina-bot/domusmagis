<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST DE DETECCIÓN</title>
    
    <!-- LIBRERÍAS MINDAR + AFRAME -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; }
        
        /* TEXTO DE ESTADO GIGANTE */
        #estado {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: red; font-size: 24px; font-weight: bold;
            background: rgba(0,0,0,0.7); padding: 20px;
            border: 2px solid white; z-index: 999;
            text-align: center; pointer-events: none;
        }

        /* BOTÓN SIMPLE PARA INICIAR (Para evitar bloqueos de navegador) */
        #btn-start {
            position: absolute; bottom: 50px; left: 50%;
            transform: translateX(-50%);
            padding: 15px 40px; font-size: 20px;
            background: blue; color: white; border: none;
            z-index: 1000; cursor: pointer;
        }
    </style>
</head>
<body>

    <!-- MENSAJE DE ESTADO -->
    <div id="estado">ESPERANDO CÁMARA...</div>

    <!-- BOTÓN DE INICIO -->
    <button id="btn-start">ENCENDER CÁMARA</button>

    <!-- ESCENA AR (Mínima configuración posible) -->
    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; uiLoading: no; uiScanning: no;" 
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- TARGET -->
        <a-entity id="target">
            <!-- CUADRO VISUAL (Para saber si se pega a la imagen) -->
            <!-- Si ves este cuadro rojo flotando sobre tu carta, FUNCIONA -->
            <a-plane color="red" opacity="0.5" width="1" height="1"></a-plane>
        </a-entity>
        
    </a-scene>

    <script>
        const btn = document.getElementById('btn-start');
        const txt = document.getElementById('estado');
        const scene = document.querySelector('a-scene');
        const target = document.getElementById('target');

        // 1. INICIAR
        btn.addEventListener('click', () => {
            txt.innerText = "CARGANDO...";
            btn.style.display = 'none'; // Ocultar botón
            scene.systems['mindar-image-system'].start();
        });

        // 2. DETECTADO
        target.addEventListener('targetFound', () => {
            txt.innerText = "¡¡ IDENTIFICADO !!";
            txt.style.color = "#0f0"; // Verde
            txt.style.borderColor = "#0f0";
        });

        // 3. PERDIDO
        target.addEventListener('targetLost', () => {
            txt.innerText = "BUSCANDO...";
            txt.style.color = "red";
            txt.style.borderColor = "red";
        });
    </script>
</body>
</html>