<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOMUS MAGI: REVELATIONS - MOTOR T√âCNICO</title>
    
    <!-- LIBRER√çAS DE VISI√ìN ARTIFICIAL Y REALIDAD AUMENTADA -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
        /* Configuraci√≥n t√©cnica del visor de c√°mara */
        body { margin: 0; overflow: hidden; background: #000; }
        .a-canvas { pointer-events: none; }
    </style>
</head>
<body>

    <!-- üìú T√çTULO 1: ESCENA RA (RECONOCIMIENTO DE MARCO DE CASA Y SILUETA DE ARMA) -->
    <a-scene 
        mindar-image="imageTargetSrc: ./targets.mind; autoStart: true; uiLoading: no; uiScanning: no;" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- MAPEADO DE TARGETS: Vincula la imagen f√≠sica con la Identidad T√©cnica -->
        <!-- El Target detecta el Marco (Casa) y la Silueta Central (Arma) simult√°neamente -->
        
        <a-entity id="target0" mindar-image-target="targetIndex: 0" 
                  data-casa="CAELUM (AZUL)" data-arma="SICA (DAGA)" data-nivel="1"></a-entity>
        
        <a-entity id="target1" mindar-image-target="targetIndex: 1" 
                  data-casa="TERRA (ROJO)" data-arma="SICA (DAGA)" data-nivel="1"></a-entity>
        
        <a-entity id="target2" mindar-image-target="targetIndex: 2" 
                  data-casa="AQUA (VERDE)" data-arma="SCUTUM (ESCUDO)" data-nivel="5"></a-entity>
        
        <a-entity id="target3" mindar-image-target="targetIndex: 3" 
                  data-casa="DIMENSIO (VIOLETA)" data-arma="CORONA (DEIDAD)" data-nivel="10"></a-entity>

    </a-scene>

    <!-- üìú T√çTULO 2: MOTOR DE ORIENTACI√ìN ASIM√âTRICA (DETECCI√ìN DE LADO POR PUNTA BLANCA) -->
    <script>
        const MOTOR_DM = {
            entidadActiva: null,
            loopId: null,

            init: function() {
                const entities = document.querySelectorAll('[mindar-image-target]');
                
                entities.forEach(entity => {
                    // EVENTO: CARTA DETECTADA
                    entity.addEventListener("targetFound", () => {
                        this.entidadActiva = entity;
                        const d = entity.dataset;
                        console.log(`[IDENTIDAD] CASA: ${d.casa} | ARMA: ${d.arma} | NIVEL: ${d.nivel}`);
                        this.rastrearGiro();
                    });

                    // EVENTO: CARTA RETIRADA
                    entity.addEventListener("targetLost", () => {
                        cancelAnimationFrame(this.loopId);
                        this.entidadActiva = null;
                        console.log("[SISTEMA] Target Perdido");
                    });
                });
            },

            // L√ìGICA DE ORIENTACI√ìN BASADA EN EL MARCADOR ASIM√âTRICO (Punta Blanca = 0¬∞)
            rastrearGiro: function() {
                const actualizar = () => {
                    if (!this.entidadActiva) return;

                    // Extraer rotaci√≥n f√≠sica del eje Z (el plano de la mesa)
                    const rotZ = this.entidadActiva.object3D.rotation.z;
                    
                    // Convertir radianes a grados absolutos (0 a 360)
                    let grados = rotZ * (180 / Math.PI);
                    if (grados < 0) grados += 360;

                    let ladoActivo = "";

                    /**
                     * DETERMINACI√ìN DE LADO SEG√öN POSICI√ìN DE LA PUNTA BLANCA
                     * Cada sector de 90¬∞ activa una funci√≥n espec√≠fica (Punto 7 Estructura Final)
                     */
                    if (grados >= 315 || grados < 45) {
                        ladoActivo = "NORTE (IMPETUS - ATAQUE)";
                    } else if (grados >= 45 && grados < 135) {
                        ladoActivo = "ESTE (AUXILIUM - CURA)";
                    } else if (grados >= 135 && grados < 225) {
                        ladoActivo = "SUR (TUTELA - DEFENSA)";
                    } else if (grados >= 225 && grados < 315) {
                        ladoActivo = "OESTE (MYSTERIUM - MAGIA)";
                    }

                    // SALIDA DE DATOS T√âCNICOS POR CONSOLA
                    console.log(`[ORIENTACI√ìN] Posici√≥n: ${ladoActivo} | √Ångulo: ${Math.round(grados)}¬∞`);

                    this.loopId = requestAnimationFrame(actualizar);
                };
                actualizar();
            }
        };

        // Inicializaci√≥n del motor t√©cnico al cargar la ventana
        window.onload = () => MOTOR_DM.init();
    </script>

</body>
</html>