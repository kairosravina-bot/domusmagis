<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOMUS MAGI: REVELATIONS</title>
    <!-- A-Frame y MindAR -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: 'Courier New', Courier, monospace; }
        
        /* ZONA ALTA: VISOR MÍSTICO (33%) */
        #video-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 33%;
            background: #000; z-index: 10; overflow: hidden; border-bottom: 2px solid #D4AF37;
        }
        #main-video { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }

        /* ZONA MEDIA: REALIDAD (40%) - El Canvas de A-Frame vive aquí */
        #ar-container {
            position: absolute; top: 33%; left: 0; width: 100%; height: 40%;
            z-index: 1; pointer-events: none;
        }

        /* ZONA BAJA: PANEL DE MANDO (27%) */
        #ui-layer {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 27%;
            background: rgba(10, 10, 10, 0.95); z-index: 20;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-top: 2px solid #D4AF37; padding: 10px; box-sizing: border-box;
        }

        /* INFO DISPLAY */
        #card-info {
            color: #D4AF37; font-size: 14px; margin-bottom: 10px; text-align: center;
            text-transform: uppercase; letter-spacing: 1px; width: 100%;
        }
        .data-row { display: flex; justify-content: space-around; width: 100%; }

        /* BOTONERA */
        .button-container {
            display: flex; justify-content: space-around; width: 100%; max-width: 400px;
        }
        .magic-btn {
            width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff;
            color: #fff; font-weight: bold; font-size: 10px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: transform 0.1s; text-shadow: 1px 1px 2px #000;
        }
        .magic-btn:active { transform: scale(0.9); }
        .magic-btn span { display: block; margin-top: 2px; font-size: 8px; }

        /* COLORES ELEMENTALES */
        .btn-red { background: linear-gradient(145deg, #8b0000, #ff0000); box-shadow: 0 0 10px #ff0000; }     /* I / MANDATUM */
        .btn-grey { background: linear-gradient(145deg, #444, #888); box-shadow: 0 0 10px #888; }             /* T / CONSILIUM */
        .btn-green { background: linear-gradient(145deg, #006400, #00ff00); box-shadow: 0 0 10px #00ff00; }   /* A / PRAESAGIUM */
        .btn-purple { background: linear-gradient(145deg, #4b0082, #9400d3); box-shadow: 0 0 10px #9400d3; }  /* M / ARCANUM */

        /* BOTON DE COMBATE CENTRAL */
        #combat-btn {
            position: absolute; bottom: 85px; width: 70px; height: 70px;
            background: url('https://cdn-icons-png.flaticon.com/512/716/716784.png') no-repeat center center;
            background-size: cover; border: none; filter: drop-shadow(0 0 5px #D4AF37);
            z-index: 25; display: none; /* Se activa al elegir lado */
        }
    </style>
</head>
<body>

    <!-- VIDEO SUPERIOR -->
    <div id="video-overlay">
        <video id="main-video" autoplay loop muted playsinline>
            <!-- Video de fondo por defecto (Ambiente) -->
            <source src="ambiente.mp4" type="video/mp4">
        </video>
    </div>

    <!-- ESCENA AR (Oculta visualmente detrás del UI pero activa) -->
    <!-- CAMBIO: target.mind sin el 1 -->
    <a-scene mindar-image="imageTargetSrc: ./target.mind; maxTrack: 1; filterMinCF:0.0001; filterBeta: 0.001;" 
             vr-mode-ui="enabled: false" 
             device-orientation-permission-ui="enabled: false"
             embedded>
        
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- TARGET 0: CARTA ESTÁNDAR (Ej: Dragón/León) -->
        <a-entity mindar-image-target="targetIndex: 0" id="target-standard"></a-entity>

        <!-- TARGET 1: CARTA BÚHO (Domus Noctua) -->
        <a-entity mindar-image-target="targetIndex: 1" id="target-owl"></a-entity>

    </a-scene>

    <!-- UI LAYER -->
    <div id="ui-layer">
        <!-- Info de la Carta Escaneada -->
        <div id="card-info">
            <div class="data-row">
                <span id="txt-escudo">ESCUDO: ---</span>
                <span id="txt-lado">LADO: ---</span>
                <span id="txt-valor">VALOR: ---</span>
            </div>
        </div>

        <!-- Botón Central (Aparece luego) -->
        <button id="combat-btn" onclick="ejecutarCombate()"></button>

        <!-- Botonera de Modos -->
        <div class="button-container">
            <!-- BOTÓN ROJO -->
            <button class="magic-btn btn-red" onclick="seleccionarModo('red')">
                <b id="lbl-red">I</b>
                <span id="sub-red">IMPETUS</span>
            </button>
            
            <!-- BOTÓN GRIS -->
            <button class="magic-btn btn-grey" onclick="seleccionarModo('grey')">
                <b id="lbl-grey">T</b>
                <span id="sub-grey">TUTELA</span>
            </button>

            <!-- BOTÓN VERDE -->
            <button class="magic-btn btn-green" onclick="seleccionarModo('green')">
                <b id="lbl-green">A</b>
                <span id="sub-green">AUXILIUM</span>
            </button>

            <!-- BOTÓN VIOLETA -->
            <button class="magic-btn btn-purple" onclick="seleccionarModo('purple')">
                <b id="lbl-purple">M</b>
                <span id="sub-purple">MYSTERIUM</span>
            </button>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS MÍNIMA ---
        const videoPlayer = document.getElementById('main-video');
        const combatBtn = document.getElementById('combat-btn');
        
        // Estado del sistema
        let cartaActiva = null; // 'standard' o 'owl'
        let modoSeleccionado = null;

        // Referencias a textos de botones
        const uiLabels = {
            red: { b: document.getElementById('lbl-red'), s: document.getElementById('sub-red') },
            grey: { b: document.getElementById('lbl-grey'), s: document.getElementById('sub-grey') },
            green: { b: document.getElementById('lbl-green'), s: document.getElementById('sub-green') },
            purple: { b: document.getElementById('lbl-purple'), s: document.getElementById('sub-purple') }
        };

        const infoTexts = {
            escudo: document.getElementById('txt-escudo'),
            lado: document.getElementById('txt-lado'),
            valor: document.getElementById('txt-valor')
        };

        // --- DETECCIÓN DE TARGETS ---
        const targetStandard = document.getElementById('target-standard');
        const targetOwl = document.getElementById('target-owl');

        // 1. Detección Carta Estándar (Index 0)
        targetStandard.addEventListener("targetFound", event => {
            console.log("Carta Estándar Detectada");
            cartaActiva = 'standard';
            actualizarInterfaz('standard');
            // Simulación de lectura de datos (en app real esto viene del backend)
            infoTexts.escudo.innerText = "ESCUDO: IGNIS"; 
            infoTexts.lado.innerText = "LADO: ATAQUE";
            infoTexts.valor.innerText = "VALOR: 8";
        });

        // 2. Detección Carta Búho (Index 1)
        targetOwl.addEventListener("targetFound", event => {
            console.log("Búho Detectado");
            cartaActiva = 'owl';
            actualizarInterfaz('owl');
            // Datos del Búho
            infoTexts.escudo.innerText = "ESCUDO: NOCTUA";
            infoTexts.lado.innerText = "LADO: SABIDURÍA";
            infoTexts.valor.innerText = "VALOR: ∞";
        });

        // --- LÓGICA DE INTERFAZ ---
        function actualizarInterfaz(tipo) {
            if (tipo === 'standard') {
                // Volver a textos originales
                uiLabels.red.b.innerText = "I"; uiLabels.red.s.innerText = "IMPETUS";
                uiLabels.grey.b.innerText = "T"; uiLabels.grey.s.innerText = "TUTELA";
                uiLabels.green.b.innerText = "A"; uiLabels.green.s.innerText = "AUXILIUM";
                uiLabels.purple.b.innerText = "M"; uiLabels.purple.s.innerText = "MYSTERIUM";
            } else if (tipo === 'owl') {
                // Cambiar a textos del Búho
                uiLabels.red.b.innerText = "M"; uiLabels.red.s.innerText = "MANDATUM";
                uiLabels.grey.b.innerText = "C"; uiLabels.grey.s.innerText = "CONSILIUM";
                uiLabels.green.b.innerText = "P"; uiLabels.green.s.innerText = "PRAESAGIUM";
                uiLabels.purple.b.innerText = "S"; uiLabels.purple.s.innerText = "ARCANUM";
            }
        }

        // --- SELECCIÓN Y DISPARO DE VIDEOS ---
        function seleccionarModo(color) {
            modoSeleccionado = color;
            combatBtn.style.display = 'block'; // Mostrar botón de combate para confirmar
            
            // Efecto visual simple
            infoTexts.lado.innerText = "LADO: CARGANDO...";
        }

        function ejecutarCombate() {
            combatBtn.style.display = 'none'; // Ocultar botón tras pulsar
            let videoSrc = "";

            if (cartaActiva === 'owl') {
                // Lógica de Videos del BÚHO
                switch(modoSeleccionado) {
                    case 'red': videoSrc = "owl_mandatum.mp4"; break;
                    case 'grey': videoSrc = "owl_consilium.mp4"; break;
                    case 'green': videoSrc = "owl_praesagium.mp4"; break;
                    case 'purple': videoSrc = "owl_arcanum.mp4"; break;
                }
                infoTexts.lado.innerText = "LADO: ACTIVO";
                infoTexts.valor.innerText = "EFECTO APLICADO";

            } else {
                // Lógica de Videos ESTÁNDAR (Ejemplos genéricos)
                switch(modoSeleccionado) {
                    case 'red': videoSrc = "ataque_fuego.mp4"; break;
                    case 'grey': videoSrc = "defensa_fisica.mp4"; break;
                    case 'green': videoSrc = "curacion.mp4"; break;
                    case 'purple': videoSrc = "magia_pura.mp4"; break;
                }
                infoTexts.lado.innerText = "LADO: COMBATE";
            }

            // Reproducir Video
            console.log("Reproduciendo: " + videoSrc);
            videoPlayer.src = videoSrc;
            videoPlayer.play();
        }

    </script>
</body>
</html>