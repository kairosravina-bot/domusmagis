<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOMUS MAGI</title>
    
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>

    <script type="module">
      import * as THREE from 'three';
      import { MindARThree } from 'mindar-image-three';

      const DB = {
        0: { casa: "CAELUM", escudo: "DRACO",  arma: "ALIENTO DE FUEGO", vid: "caelum.mp4", i: 6, t: 2, a: 1, m: 1 },
        1: { casa: "CAELUM", escudo: "AQUILA", arma: "GARRA CELESTIAL",  vid: "caelum.mp4", i: 4, t: 2, a: 1, m: 3 },
        2: { casa: "TERRA",  escudo: "LEO",    arma: "RUGIDO SONICO",    vid: "terra.mp4",  i: 4, t: 4, a: 1, m: 1 },
        3: { casa: "TERRA",  escudo: "APER",   arma: "EMBESTIDA BRUTAL", vid: "terra.mp4",  i: 3, t: 5, a: 1, m: 1 }
      };

      let carta = null;

      const init = async () => {
        const container = document.querySelector("#scanner");
        
        const mindarThree = new MindARThree({
          container: container,
          imageTargetSrc: "./targets1.mind",
          filterMinCF: 0.0001, 
          filterBeta: 0.001
        });

        const {renderer, scene, camera} = mindarThree;

        for (let i = 0; i < 4; i++) {
          const anchor = mindarThree.addAnchor(i);
          
          anchor.onTargetFound = () => {
            carta = DB[i];
            
            const video = document.querySelector("#video-player");
            video.src = carta.vid;
            video.pause();
            video.currentTime = 0;

            document.querySelector("#linea1").textContent = 
              `CASA: ${carta.casa} - ESCUDO: ${carta.escudo} - ARMA: ${carta.arma}`;

            document.querySelector("#linea2").textContent = "";

            document.querySelector("#controles").style.display = "flex";
          };
        }

        await mindarThree.start();
        
        renderer.setAnimationLoop(() => {
          renderer.render(scene, camera);
        });
      }

      window.elegir = (tipo, nombre) => {
        if (!carta) return;

        const valor = carta[tipo];
        
        document.querySelector("#linea2").textContent = `PODER: ${nombre} - VALOR: ${valor}`;

        const video = document.querySelector("#video-player");
        video.currentTime = 0;
        video.play();
      };

      document.querySelector("#btn-iniciar").addEventListener("click", () => {
        document.querySelector("#inicio").style.display = "none";
        init();
      });
    </script>

    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      
      body { 
        width: 100vw; 
        height: 100vh; 
        background: #000; 
        color: white;
        font-family: Arial, sans-serif;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      #inicio { 
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #111;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
      }
      
      h2 { color: gold; font-size: 28px; }
      
      #btn-iniciar { 
        padding: 20px 40px;
        font-size: 22px;
        background: linear-gradient(135deg, #8b44ff, #bb44ff);
        border: none;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(139, 68, 255, 0.5);
      }
      
      #btn-iniciar:active {
        box-shadow: 0 0 80px rgba(139, 68, 255, 1), 0 0 120px rgba(187, 68, 255, 1);
        filter: brightness(1.5);
      }
      
      #version {
        font-size: 12px;
        color: #888;
        font-family: monospace;
        letter-spacing: 2px;
      }

      /* TERCIO 1: VIDEO */
      #video-container {
        width: 100%;
        height: 33.33vh;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      #video-player {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      /* TERCIO 2: SCANNER */
      #scanner {
        width: 100%;
        height: 33.33vh;
        background: #222;
        position: relative;
      }

      /* TERCIO 3: INFO + BOTONES */
      #controles {
        width: 100%;
        height: 33.34vh;
        background: #111;
        display: none;
        flex-direction: column;
        padding: 20px;
        gap: 15px;
      }

      #linea1 {
        font-size: 14px;
        color: #fff;
        text-align: center;
        background: rgba(255,255,255,0.1);
        padding: 12px;
        border-radius: 8px;
      }

      #linea2 {
        font-size: 16px;
        color: #0f0;
        font-weight: bold;
        text-align: center;
        background: rgba(0,255,0,0.1);
        padding: 12px;
        border-radius: 8px;
        min-height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #botones {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        gap: 10px;
        margin-top: auto;
        padding-bottom: 20px;
      }

      .btn {
        width: 70px;
        height: 70px;
        font-size: 32px;
        font-weight: bold;
        color: white;
        border: none;
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      }

      .btn:active {
        transform: scale(0.9);
      }

      .btn-i { background: #ff4444; }
      .btn-t { background: #aaaaaa; }
      .btn-a { background: #44ff44; }
      .btn-m { background: #aa44ff; }
    </style>
  </head>
  <body>

    <div id="inicio">
      <h2>DOMUS MAGI</h2>
      <button id="btn-iniciar">ACTIVAR SISTEMA</button>
      <div id="version">v1.0.3 BETA</div>
    </div>

    <div id="video-container">
      <video id="video-player" playsinline muted></video>
    </div>

    <div id="scanner"></div>

    <div id="controles">
      <div id="linea1"></div>
      <div id="linea2"></div>
      
      <div id="botones">
        <div class="btn btn-i" onclick="elegir('i', 'INTELIGENCIA')">I</div>
        <div class="btn btn-t" onclick="elegir('t', 'TÃ‰CNICA')">T</div>
        <div class="btn btn-a" onclick="elegir('a', 'AGILIDAD')">A</div>
        <div class="btn btn-m" onclick="elegir('m', 'MAGIA')">M</div>
      </div>
    </div>

  </body>
</html>