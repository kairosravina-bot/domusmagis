<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOMUS MAGI - BATTLE HUD</title>
    
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js"
      }
    }
    </script>

    <style>
        body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; overflow: hidden; color: white; }

        /* 1. VISOR MÍSTICO (ZONA ALTA 33%) */
        #visor-superior {
            position: absolute; top: 0; width: 100%; height: 33vh;
            background: #111; border-bottom: 3px solid #fff; z-index: 100;
            overflow: hidden; display: flex; justify-content: center; align-items: center;
        }
        #video-background { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }

        /* CAPA DE DATOS (LAYER SOBRE MP4) */
        #hud-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: space-between; padding: 15px; box-sizing: border-box;
            pointer-events: none; background: linear-gradient(to bottom, rgba(0,0,0,0.5), transparent);
        }
        .hud-escudo { width: 60px; height: 60px; border: 2px solid white; border-radius: 5px; background: rgba(255,255,255,0.1); }
        .hud-stats { text-align: right; font-family: monospace; }
        .stat-line { font-size: 18px; font-weight: bold; text-shadow: 2px 2px 4px #000; }
        #nombre-casa { font-size: 24px; color: #ffd700; letter-spacing: 2px; display: block; margin-bottom: 5px; }

        /* 2. VENTANA DE REALIDAD (ZONA MEDIA 40%) */
        #container { position: absolute; top: 33vh; width: 100%; height: 40vh; z-index: 1; }

        /* 3. PANEL DE MANDO (ZONA BAJA 27%) */
        #panel-mando {
            position: absolute; bottom: 0; width: 100%; height: 27vh;
            background: rgba(10, 10, 10, 0.95); z-index: 100;
            display: flex; justify-content: center; align-items: center; gap: 15px;
            border-top: 2px solid #333;
        }
        .btn {
            width: 55px; height: 55px; border-radius: 10px; border: 2px solid white;
            font-size: 22px; font-weight: bold; color: white; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
        }
        .btn-i { background: #b00; } .btn-t { background: #555; }
        .btn-a { background: #080; } .btn-m { background: #60a; }
        #btn-combate { 
            width: 80px; height: 80px; border-radius: 50%; background: gold; color: black; 
            font-size: 12px; border: 4px solid #fff; box-shadow: 0 0 15px gold;
        }

        /* INICIO */
        #ui-inicio {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 1000; display: flex; justify-content: center; align-items: center;
        }
        #startButton { padding: 20px 40px; font-size: 20px; background: #0f0; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ui-inicio">
        <button id="startButton">INICIAR DOMUS MAGI</button>
    </div>

    <!-- ZONA 1: VISOR CON LAYER MP4 -->
    <div id="visor-superior">
        <video id="video-background" loop playsinline></video>
        <div id="hud-layer">
            <div id="escudo-contenedor">
                <img id="hud-img-escudo" src="" class="hud-escudo" style="display:none;">
            </div>
            <div class="hud-stats">
                <span id="nombre-casa">ESPERANDO...</span>
                <div class="stat-line" style="color:#ff4444">I: <span id="val-i">0</span></div>
                <div class="stat-line" style="color:#aaa">T: <span id="val-t">0</span></div>
                <div class="stat-line" style="color:#44ff44">A: <span id="val-a">0</span></div>
                <div class="stat-line" style="color:#bb44ff">M: <span id="val-m">0</span></div>
            </div>
        </div>
    </div>

    <!-- ZONA 2: CÁMARA (MindAR) -->
    <div id="container"></div>

    <!-- ZONA 3: MANDO -->
    <div id="panel-mando">
        <div class="btn btn-i">I</div>
        <div class="btn btn-t">T</div>
        <button id="btn-combate">COMBATE</button>
        <div class="btn btn-a">A</div>
        <div class="btn btn-m">M</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { MindARThree } from 'mindar-image-three';

        // DATABASE DE CASAS (Ajustada a tus escudos)
        const CASAS = {
            0: { nombre: "DRACO",  img: "draco.png",  i: 6, t: 2, a: 1, m: 1, vid: "caelum.mp4" },
            1: { nombre: "AQUILA", img: "aquila.png", i: 4, t: 2, a: 1, m: 3, vid: "caelum.mp4" },
            2: { nombre: "LEO",    img: "leo.png",    i: 4, t: 4, a: 1, m: 1, vid: "terra.mp4" },
            3: { nombre: "APER",   img: "aper.png",   i: 3, t: 5, a: 1, m: 1, vid: "terra.mp4" }
        };

        const init = async () => {
            const mindarThree = new MindARThree({
                container: document.querySelector("#container"),
                imageTargetSrc: "./targets1.mind",
                filterMinCF: 0.0001, filterBeta: 0.001
            });

            const {renderer, scene, camera} = mindarThree;

            // CONFIGURAR CADA ANCHOR
            for (let i = 0; i < 4; i++) {
                const anchor = mindarThree.addAnchor(i);
                
                anchor.onTargetFound = () => {
                    const datos = CASAS[i];
                    document.querySelector("#nombre-casa").innerText = datos.nombre;
                    document.querySelector("#val-i").innerText = datos.i;
                    document.querySelector("#val-t").innerText = datos.t;
                    document.querySelector("#val-a").innerText = datos.a;
                    document.querySelector("#val-m").innerText = datos.m;
                    
                    // Actualizar Imagen Escudo en el Layer
                    const imgEscudo = document.querySelector("#hud-img-escudo");
                    imgEscudo.src = datos.img;
                    imgEscudo.style.display = "block";

                    // Cambiar Video de Fondo según la Casa
                    const video = document.querySelector("#video-background");
                    video.src = datos.vid;
                    video.play();
                };

                anchor.onTargetLost = () => {
                    // Mantenemos los datos fijos según el diseño híbrido
                };
            }

            await mindarThree.start();
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        }

        document.querySelector("#startButton").addEventListener("click", () => {
            document.querySelector("#ui-inicio").style.display = "none";
            init();
        });
    </script>
</body>
</html>