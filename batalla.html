<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DOMUS MAGI: FIRST BLOOD V005 (AR FUNCIONAL)</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- IMPORTMAP PARA M√ìDULOS -->
    <script type="importmap">
    { "imports": { 
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js", 
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/", 
        "mindar-image-three":"https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js" 
    } }
    </script>
</head>
<body>
    <div id="container-ar"></div>

    <!-- MODAL FASE DE DADOS EN BATALLA -->
    <div id="modal-dados-fase" class="pantalla oculto" style="z-index:9500; background:rgba(0,0,0,0.85);">
        <h2 style="color:#aaa; margin:0;">DESTINO</h2>
        <h1 id="dados-player-name" style="font-size:36px; margin:5px 0;">JUGADOR</h1>
        
        <div class="dados-container">
            <video id="video-dados-batalla" class="video-dados" src="https://kairosravina-bot.github.io/domusmagis/Dados.mp4" playsinline webkit-playsinline muted></video>
            <div id="layer-valor-batalla" class="layer-valor">0</div>
        </div>

        <h3 style="margin: 0; margin-top:5px; color:#888; font-size:14px;">SELECCIONA TUS DADOS:</h3>
        <div class="grid-dados">
            <div class="btn-dado-sel" id="btn-batalla-2" onclick="window.ejecutarLanzamientoBatalla(2)"><strong>2</strong><span>(12)</span></div>
            <div class="btn-dado-sel" id="btn-batalla-3" onclick="window.ejecutarLanzamientoBatalla(3)"><strong>3</strong><span>(18)</span></div>
            <div class="btn-dado-sel" id="btn-batalla-4" onclick="window.ejecutarLanzamientoBatalla(4)"><strong>4</strong><span>(24)</span></div>
            <div class="btn-dado-sel" id="btn-batalla-5" onclick="window.ejecutarLanzamientoBatalla(5)"><strong>5</strong><span>(30)</span></div>
        </div>
    </div>

    <!-- PANTALLA CAMBIO TURNO -->
    <div id="pantalla-cambio-turno" class="pantalla oculto" style="z-index:8000; background: rgba(0,0,0,0.6);">
        <div style="background:rgba(20,20,20,0.95); padding:20px; border-radius:10px; border:2px solid gold; box-shadow: 0 0 20px #000;">
            <h1 style="font-size:50px; color: #ff4444; margin:0;">üõë ALTO üõë</h1>
            <p style="font-size:22px; color:#aaa;">ES EL TURNO DE:</p>
            <h2 style="color:var(--borde-dorado); font-size:50px;" id="next-player-name">JUGADOR</h2>
            <button class="btn-master" style="margin-top:30px; width:100%;" onclick="window.confirmarCambioTurno()">TOMAR EL MANDO</button>
        </div>
    </div>

    <!-- SETUP -->
    <div id="p-setup" class="pantalla" style="background:rgba(0,0,0,0.8);">
        <h2>INSCRIPCI√ìN</h2>
        <div id="setup-selector" style="display:flex; gap:10px; width:100%; flex-wrap:wrap; justify-content:center;">
            <button class="btn-master" onclick="window.setModo(2)" style="flex:1; min-width:150px;">2 MAGOS</button>
            <button class="btn-master" onclick="window.setModo(4)" style="flex:1; min-width:150px;">4 MAGOS</button>
        </div>
        <div id="registro" class="oculto" style="width:100%;">
            <input type="text" id="mago-nombre" placeholder="NOMBRE DEL MAGO" autocomplete="off">
            <div class="grid-casas">
                <button onclick="window.registrarMago('TIERRA','#ff0000','ESCUDO_LEON.png')" class="btn-casa" style="background:#500; border-color:#f00;">ü™® TIERRA</button>
                <button onclick="window.registrarMago('CIELO','#00aaff','ESCUDO_AGUILA.png')" class="btn-casa" style="background:#003; border-color:#0af;">‚òÅÔ∏è CIELO</button>
                <button onclick="window.registrarMago('AGUA','#00ff88','ESCUDO_TRITON.png')" class="btn-casa" style="background:#030; border-color:#0f8;">üíß AGUA</button>
                <button onclick="window.registrarMago('MAGIA','#aa00ff','ESCUDO_ARCANUM.png')" class="btn-casa" style="background:#303; border-color:#d0f;">‚ú® MAGIA</button>
            </div>
            <p id="reg-status" style="color:var(--borde-dorado); text-align:center; font-size:24px; margin-top:20px; font-weight:900;"></p>
        </div>
        <button class="btn-master" style="margin-top:20px; background:#333;" onclick="window.location.href='index.html'">CANCELAR</button>
    </div>

    <!-- UI JUEGO -->
    <div id="ui-juego" class="oculto">
        <div id="zona-superior">
            <div id="txt-turno" style="position: absolute; top: 15px; left: 15px; z-index: 15; background: rgba(0,0,0,0.8); color: gold; padding: 10px; border: 2px solid gold;">TURNO: ---</div>
            <div id="guia-scanner" style="width: 240px; height: 240px; border: 6px solid rgba(255,255,255,0.6); border-radius: 20px; z-index: 10;"></div>
        </div>

        <div id="zona-inferior">
            <div id="msg-visor" style="font-size:26px; color:var(--borde-dorado); font-weight:900;">ESCANEA CARTA</div>
            <p style="color:#aaa; font-size:20px; margin:0;">SLOT: <span id="slot-indicator" style="color:gold;">1/3</span></p>
            
            <!-- GEMAS NEON -->
            <div class="contenedor-gemas" style="display: flex; gap: 15px; margin: 5px 0; justify-content: center; align-items: flex-end;">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <span id="val-i" style="font-size: 40px; font-weight: 900; margin-bottom: 2px; height: 45px;"></span>
                    <button id="btn-i" class="btn-gema" onclick="window.seleccionarBoton('btn-i')" style="width: 80px; height: 80px; background-color: transparent; border: none; cursor: pointer;"><span style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 5px #000;">I</span></button>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <span id="val-a" style="font-size: 40px; font-weight: 900; margin-bottom: 2px; height: 45px;"></span>
                    <button id="btn-a" class="btn-gema" onclick="window.seleccionarBoton('btn-a')" style="width: 80px; height: 80px; background-color: transparent; border: none; cursor: pointer;"><span style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 5px #000;">A</span></button>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <span id="val-t" style="font-size: 40px; font-weight: 900; margin-bottom: 2px; height: 45px;"></span>
                    <button id="btn-t" class="btn-gema" onclick="window.seleccionarBoton('btn-t')" style="width: 80px; height: 80px; background-color: transparent; border: none; cursor: pointer;"><span style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 5px #000;">T</span></button>
                </div>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <span id="val-m" style="font-size: 40px; font-weight: 900; margin-bottom: 2px; height: 45px;"></span>
                    <button id="btn-m" class="btn-gema" onclick="window.seleccionarBoton('btn-m')" style="width: 80px; height: 80px; background-color: transparent; border: none; cursor: pointer;"><span style="font-size: 32px; font-weight: 900; color: #fff; text-shadow: 0 2px 5px #000;">M</span></button>
                </div>
            </div>
            
            <div style="display:flex; gap:10px; width:100%;">
                <button id="btn-confirmar" class="btn-master" style="background:#050; border-color:#0f0; flex:2;">‚úÖ CONFIRMAR</button>
                <button id="btn-forzar" class="btn-master" style="background:#500; font-size:14px;" onclick="window.forzarBatalla()">‚öîÔ∏è YA</button>
            </div>
        </div>
    </div>

    <!-- RESULTADOS -->
    <div id="p-resultado" class="pantalla oculto" style="background:rgba(0,0,0,0.8);">
        <h2 style="color:#331a00; border-bottom:2px solid #8b4513; width:100%; text-shadow:none; background:rgba(255,255,255,0.8); padding:5px;">DECRETO FINAL</h2>
        <div id="resultado-batalla" style="background-color:rgba(26,5,5,0.9); color:#fff; padding:20px; flex-grow:1; overflow-y:auto; border-radius:5px; border: 4px solid #5a3a22;">
            <div id="resultado-contenido"></div>
        </div>
        <div style="width:100%; display:flex; gap:10px; margin:20px 0;">
            <button class="btn-master" onclick="window.continuarContienda()">‚öîÔ∏è REPETIR</button>
            <button class="btn-master" style="background:#111; border-color:#f00;" onclick="window.location.href='index.html'">üö™ SALIR</button>
        </div>
        <div id="seccion-historial" style="background:rgba(0,0,0,0.7);">
            <h3 style="color:#aaa; font-size:20px;">CR√ìNICAS DE BATALLA</h3>
            <div id="lista-historial"></div>
        </div>
    </div>

    <!-- L√ìGICA DEL JUEGO CON AR INTEGRADO -->
    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
        import { MindARThree } from 'https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-three.prod.js';

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DOMUS MAGI - FIRST BLOOD V.005 (AR FUNCIONAL)
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        const RUTA_BASE = "https://kairosravina-bot.github.io/domusmagis/";
        
        const CARTAS = {
            0: { id: 0, nombre: "APER (JABAL√ç)", arma: "BESTIA", imgEscudo: "ESCUDO_LEON.png", botones: { "btn-i": { label: "IMPETUS", valor: 6 }, "btn-a": { label: "AUXILIUM", valor: 1 }, "btn-t": { label: "TUTELA", valor: 5 }, "btn-m": { label: "MYSTERIUM", valor: 0 } } },
            1: { id: 1, nombre: "SAXUM (GOLEM)", arma: "BESTIA", imgEscudo: "ESCUDO_LEON.png", botones: { "btn-i": { label: "IMPETUS", valor: 3 }, "btn-a": { label: "AUXILIUM", valor: 1 }, "btn-t": { label: "TUTELA", valor: 12 }, "btn-m": { label: "MYSTERIUM", valor: 1 } } },
            2: { id: 2, nombre: "GAIA (MATRONA)", arma: "BESTIA", imgEscudo: "ESCUDO_LEON.png", botones: { "btn-i": { label: "IMPETUS", valor: 4 }, "btn-a": { label: "AUXILIUM", valor: 3 }, "btn-t": { label: "TUTELA", valor: 7 }, "btn-m": { label: "MYSTERIUM", valor: 5 } } },
            3: { id: 3, nombre: "LUPUS (LOBO)", arma: "BESTIA", imgEscudo: "ESCUDO_LEON.png", botones: { "btn-i": { label: "IMPETUS", valor: 7 }, "btn-a": { label: "AUXILIUM", valor: 1 }, "btn-t": { label: "TUTELA", valor: 4 }, "btn-m": { label: "MYSTERIUM", valor: 1 } } },
            4: { id: 4, nombre: "COLOSSUS (TIT√ÅN)", arma: "BESTIA", imgEscudo: "ESCUDO_LEON.png", botones: { "btn-i": { label: "IMPETUS", valor: 8 }, "btn-a": { label: "AUXILIUM", valor: 0 }, "btn-t": { label: "TUTELA", valor: 6 }, "btn-m": { label: "MYSTERIUM", valor: 0 } } }
        };

        // ESTADO DEL JUEGO
        let cantJugadores = 0;
        let jugadores = [];
        let turnoJugadorIdx = 0;
        let slotActual = 0;
        let jugadaPendiente = null;
        let dadosSeleccionadosBatalla = 2;
        let contadorPartidas = 0;
        let historialPartidas = [];
        let mindarThree = null;

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // SETUP DE MAGOS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        window.setModo = (numMagos) => {
            cantJugadores = numMagos;
            document.getElementById('setup-selector').classList.add('oculto');
            document.getElementById('registro').classList.remove('oculto');
            document.getElementById('reg-status').innerText = `Inscribe ${numMagos} magos (0/${numMagos})`;
        };

        window.registrarMago = (casa, color, escudo) => {
            const nombre = document.getElementById('mago-nombre').value.trim().toUpperCase();
            if(!nombre) { alert("Escribe un nombre"); return; }
            
            jugadores.push({
                nombre: nombre,
                casa: casa,
                color: color,
                imgEscudo: escudo,
                slots: [null, null, null],
                dado: 0
            });
            
            const registrados = jugadores.length;
            document.getElementById('reg-status').innerText = `Inscribe ${cantJugadores} magos (${registrados}/${cantJugadores})`;
            document.getElementById('mago-nombre').value = "";
            
            if(registrados === cantJugadores) {
                setTimeout(() => {
                    document.getElementById('p-setup').classList.add('oculto');
                    document.getElementById('ui-juego').classList.remove('oculto');
                    iniciarAR();
                    actualizarUI();
                }, 500);
            }
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // REALIDAD AUMENTADA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        const iniciarAR = async () => {
            console.log("üîç Iniciando REALIDAD AUMENTADA...");
            
            try {
                mindarThree = new MindARThree({
                    container: document.getElementById('container-ar'),
                    imageTargetSrc: RUTA_BASE + 'targets1.mind',
                    maxTrack: 1,
                    uiLoading: "no",
                    uiScanning: "no",
                    uiError: "no"
                });

                const { renderer, scene, camera } = mindarThree;

                // Crear anclas para todas las cartas
                for (let i = 0; i < 58; i++) {
                    const anchor = mindarThree.addAnchor(i);
                    const geometry = new THREE.PlaneGeometry(1, 1);
                    const material = new THREE.MeshBasicMaterial({ transparent: true, opacity: 0 });
                    const plane = new THREE.Mesh(geometry, material);
                    anchor.group.add(plane);

                    anchor.onTargetFound = () => {
                        console.log(`‚úÖ DETECTADA CARTA ID: ${i}`);
                        manejarCartaEscaneada(i);
                    };

                    anchor.onTargetLost = () => {
                        console.log(`‚ùå PERDIDA CARTA ID: ${i}`);
                        document.getElementById('guia-scanner').classList.remove('verde', 'dorado', 'violeta');
                    };
                }

                await mindarThree.start();
                console.log("‚úÖ AR iniciado correctamente - LISTO PARA ESCANEAR");
                
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });

            } catch (error) {
                console.error("‚ùå Error AR:", error);
                alert("Error AR: " + error.message);
            }
        };

        const manejarCartaEscaneada = (cartaId) => {
            if(!CARTAS[cartaId]) {
                console.log(`Carta ${cartaId} no tiene datos`);
                return;
            }

            const carta = CARTAS[cartaId];
            jugadaPendiente = { carta: carta, cartaId: cartaId };

            document.getElementById('msg-visor').innerText = `‚úÖ ${carta.nombre}`;
            document.getElementById('guia-scanner').classList.add('verde');
            
            // Mostrar valores de botones
            ['btn-i', 'btn-a', 'btn-t', 'btn-m'].forEach(btnId => {
                const config = carta.botones[btnId];
                document.getElementById(`val-${btnId.split('-')[1]}`).innerText = config.valor;
            });
        };

        window.seleccionarBoton = (btnId) => {
            if(!jugadaPendiente) { console.log("Sin carta"); return; }
            
            const config = jugadaPendiente.carta.botones[btnId];
            jugadaPendiente.lado = config.label;
            jugadaPendiente.valor = config.valor;
            
            document.getElementById('msg-visor').innerText = `${config.label}: +${config.valor}`;
        };

        const actualizarUI = () => {
            const jugador = jugadores[turnoJugadorIdx];
            document.getElementById('txt-turno').innerText = `TURNO: ${jugador.nombre}`;
            document.getElementById('slot-indicator').innerText = `${slotActual + 1}/3`;
        };

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EVENTOS DE JUEGO
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        document.getElementById('btn-confirmar').onclick = () => {
            if(!jugadaPendiente) { alert("Escanea primero"); return; }
            
            jugadores[turnoJugadorIdx].slots[slotActual] = jugadaPendiente;
            turnoJugadorIdx++;
            
            if(turnoJugadorIdx >= cantJugadores) {
                turnoJugadorIdx = 0;
                slotActual++;
            }
            
            if(slotActual >= 3) {
                forzarBatalla();
            } else {
                document.getElementById('pantalla-cambio-turno').classList.remove('oculto');
                document.getElementById('next-player-name').innerText = jugadores[turnoJugadorIdx].nombre;
            }
            
            jugadaPendiente = null;
        };

        window.confirmarCambioTurno = () => {
            document.getElementById('pantalla-cambio-turno').classList.add('oculto');
            actualizarUI();
        };

        window.forzarBatalla = () => {
            document.getElementById('modal-dados-fase').classList.remove('oculto');
            document.getElementById('dados-player-name').innerText = jugadores[turnoJugadorIdx].nombre;
        };

        window.ejecutarLanzamientoBatalla = (n) => {
            dadosSeleccionadosBatalla = n;
            [2,3,4,5].forEach(i => {
                const btn = document.getElementById(`btn-batalla-${i}`);
                if(btn) btn.classList.remove('tageado');
            });
            document.getElementById(`btn-batalla-${n}`).classList.add('tageado');

            const vid = document.getElementById('video-dados-batalla');
            const layer = document.getElementById('layer-valor-batalla');
            
            layer.style.display = 'none';
            vid.currentTime = 0;
            vid.play();
            
            vid.onended = () => {
                let total = 0;
                for(let i=0; i<n; i++) total += Math.floor(Math.random()*6) + 1;
                layer.innerText = total;
                layer.style.display = 'flex';
                
                setTimeout(() => {
                    jugadores[turnoJugadorIdx].dado = total;
                    turnoJugadorIdx++;
                    if(turnoJugadorIdx >= cantJugadores) {
                        mostrarResultados();
                    } else {
                        document.getElementById('modal-dados-fase').classList.add('oculto');
                        document.getElementById('pantalla-cambio-turno').classList.remove('oculto');
                        document.getElementById('next-player-name').innerText = jugadores[turnoJugadorIdx].nombre;
                    }
                }, 1500);
            };
        };

        const mostrarResultados = () => {
            document.getElementById('modal-dados-fase').classList.add('oculto');
            document.getElementById('ui-juego').classList.add('oculto');
            document.getElementById('p-resultado').classList.remove('oculto');
            
            const cont = document.getElementById('resultado-contenido');
            cont.innerHTML = '';
            
            let resultados = jugadores.map(j => {
                let total = 0;
                j.slots.forEach(s => { if(s) total += s.valor; });
                return {...j, total: total + j.dado};
            });
            resultados.sort((a,b) => b.total - a.total);

            contadorPartidas++;
            const ganador = resultados[0];
            historialPartidas.push({ id: contadorPartidas, nombre: ganador.nombre, pts: ganador.total });

            resultados.forEach((r, i) => {
                cont.innerHTML += `
                <div style="background:rgba(255,255,255,0.05); margin: 15px 0; padding: 15px; border-bottom: 2px solid #5a3a22; ${i===0?'border: 3px solid #d4af37;':''} ">
                    <h3 style="color:${r.color}; margin:0;">${r.nombre}</h3>
                    <div style="margin-top:10px; font-size:60px; color:#ffd700; font-weight:900;">${r.total}</div>
                </div>`;
            });
        };

        window.continuarContienda = () => {
            jugadores.forEach(j => { j.slots = [null, null, null]; j.dado = 0; });
            slotActual = 0;
            turnoJugadorIdx = 0;
            document.getElementById('p-resultado').classList.add('oculto');
            document.getElementById('ui-juego').classList.remove('oculto');
            actualizarUI();
        };

        console.log('‚úÖ DOMUS MAGI V005 - AR INTEGRADO Y FUNCIONAL');
    </script>
</body>
</html>